{% extends "grade/poll/managment/base.html" %}

{% block scripts %}

<script src="/site_media/js/grade/poll/create.js" type="text/javascript"></script>
<script src="/site_media/js/grade/ticket_create/keys_generate.js" type="application/javascript"></script>
<script type="text/javascript" src="/site_media/js/jquery/jquery-ui-1.8.1.custom.min.js"></script>
<script type="text/javascript">
    var url_generate = '{% url grade-ticket-keys-generator %}'
    var url_progress = '{% url grade-ticket-keys-progress %}'
</script>
	
{% endblock %}

{% block styles %}
	<link rel="stylesheet" href="/site_media/css/grade/create.css" type="text/css" />
    <link rel="stylesheet" href="/site_media/css/grade/answer.css" type="text/css" />
	<link rel="stylesheet" href="/site_media/css/grade/poll-managment.css" type="text/css" />
    <link rel="stylesheet" href="/site_media/css/ui-progressbar.css" type="text/css" />
{% endblock %}


{% block poll-managment %}

	{% if message == "Utworzono ankiety!" %}
		<div class="main-message">
			{% if polls_len == 0 %}
				Nie utworzono żadnej ankiety.
			{% else %}
				Liczba utworzonych ankiet: {{polls_len}}
				<ul>
					{% for poll in polls %}
						<li>{{poll}}</li>
					{% endfor %}
				</ul>
			{% endif %}
		</div>
	{% else %}
		{% if message %}
		<div class="main-message">
				{{ message }}
		</div>
		{% endif %}
	{% endif %}
        <form method="POST" id="poll-create">
            <table>
                <tr>
                    <td>
                        <label for="semester">Semestr: </label>
                    </td>
                    <td>
                        <select name="semester" id="semester">
                            {% for sem in semesters %}
                                <option value="{{sem.pk}}"{% if semester.pl == sem.pl %} selected{% endif %}>{{sem}}</option>
                            {% endfor %}
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="studies-type">Typ studiów: </label>
                    </td>
                    <td>
                        <select name="studies-type" id="studies-type">
                            <option value="-1">Dowolny</option>
                            {% for study_type in studies_types %}
                                <option value="{{study_type.pk}}"{% if study_type.pk == studies_type %} selected{% endif %}>{{study_type}}</option>
                            {% endfor %}
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="subjects">Przedmiot: </label>
                    </td>
                    <td>
                        <select name="subject" id="subjects">
                            <option value="-1">Nie przypisane do przedmiotu</option>
                            <option value="0"{% if subject_id == 0 %} selected{% endif %}>Wszystkie przedmioty</option>
                            {% for subject in subjects %}
                                <option value="{{subject.pk}}"{% if subject_id == subject.pk %} selected{% endif %}>{{subject.name}}</option>
                            {% endfor %}
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="type" class="type-visibility">Typ zajęć: </label>
                    </td>
                    <td>
                        <select name="type" id="type" class="type-visibility">
                            <option value="0">Wszystkie typy</option>
                            {% for k, v in types %}{{k}}
                                <option value="{{k}}"{% if type == k %} selected{% endif %}>{{v}}</option>
                            {% endfor %}
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="group" class="group-visibility">Grupa: </label>
                    </td>
                    <td>
                        <select name="group" id="group" class="group-visibility">
                            <option value="0">Wszystkie grupy</option>
                            {% if group > 0 %}
                                {% for gr in groups %}
                                    <option value="{{ gr.pk }}"{% if gr.pk == group %} selected{% endif %}>{{ gr }}</option>
                                {% endfor %}
                            {% endif %}
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="poll-only-without">Utwórz tylko dla grup bez ankiet</label>
                    </td>
                    <td>
                        <input type="checkbox" name="poll-only-without" id="poll-only-without"{% if poll_without %} checked{% endif %}>
                    </td>
                </tr>
            </table>
                        <label for="title">Tytuł:</label>

            <input type="text" name="title" id="title"><br>
            <label for="description">Opis</label>
            <textarea name="description"></textarea>
            
            <div id="sections-list">
                Wybrane sekcje: <!-- TODO: brak, gdy puste -->
                <ul>
                </ul><small>(Przeciągnij, aby zmienić kolejność)</small>
            </div><br/>
            <label for="sections">Wybierz sekcję:</label>
            <select name="section" id="sections">
                {% for section in sections %}
                    <option value="{{section.pk}}">{{section}}</option>
                {% endfor %}
            </select>
            <input id="section-add" type="button" value="Dodaj sekcję"><br/>
            <input id="poll-create-submit" type="submit" value="Stwórz ankietę">
        </form>

    {% comment %} Grey screen {% endcomment %}
    <div id='box'>
        <h2>Trwa generowanie kluczy</h2>
        <div id="progressbar"></div>
        <span id="generated-keys">0</span> / <span id="all-keys">{{polls_len}}</span> (<span id="keys-percent">0</span>%)
        <br>
        (Kliknięcie ukrywa ten komunikat. Nie przerywa jednak procesu.)
    </div>

    <div id='screen'>
    </div>
{% endblock %}

