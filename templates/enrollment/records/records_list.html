{% extends "enrollment/courses/base.html" %}

{% block main-subtitle %}
	{{group.course.name}}
	({{group.get_type_display}}: {{group.get_teacher_full_name}})
{% endblock %}

{% block main-navigation %}
	<li><a href="{% url main-page %}">Strona główna</a></li>
	<li><a href="{% url enrollment-main %}">Zapisy</a></li>
	<li><a href="{% url course-list %}">Przedmioty</a></li>
	<li>
		<a href="{% url course-page group.course.slug %}"
			>{{group.course.name}}</a>
	</li>
	<li>{{group.get_type_display}}: {{group.get_teacher_full_name}}</li>
{% endblock %}

{% block content %}
	<div id="enr-group-view">


        <h1>{{group.course.name}}</h1>
        {% if user.is_staff %}
        <a href="{% url admin:courses_group_change group.pk %}">Edycja</a>
        {% endif %}
        <div class="details">
            <ul class="properties">
                <li>
                    <span>Typ:</span>
                    {{group.get_type_display}}
                </li>
                <li>
                    <span>Prowadzący:</span>
                    {% if group.teacher %}
                        <a href="{% url employee-profile group.teacher.user.id %}" class="person">{{group.get_teacher_full_name}}</a>
                    {% else %}
                        {{group.get_teacher_full_name}}
                    {% endif %}
                </li>
                <li>
                    <span>Termin:</span>
                    {% for term in group.get_all_terms %}
                        {{term}}{%if not forloop.last %}, {% endif %}
                    {% endfor %}
                </li>


            </ul>
        </div>

        <hr>

		<br/>
		<h3>Lista osób zapisanych na przedmiot:</h3>
		{% if group.limit_zamawiane %}
			<p>Zapisanych w ramach limitu studiów zamawianych:
				{{ group.number_of_students_zamawiane }}
				/ {{ group.limit_zamawiane }}.
			</p>
			<p>Zapisanych w ramach limitu dodatkowego:
				{{ group.number_of_students_non_zamawiane }}
				/ {{ group.limit_non_zamawiane }}.
			</p>
		{% else %}
			<p>Liczba zapisanych osób: {{students_in_group|length}} /
			{{group.get_group_limit}}</p>
		{% endif %}

		<br/>
		
		<table class="zebra-striped">
			<thead>
				<td>Imię i nazwisko</td>
				<td>Nr indeksu</td>
				<td>Rodzaj studiów</td>
				<td>Semestr</td>
			</thead>
			<tbody>
				{% for student in students_in_group %}
					<tr>
						<td><a href="{% url student-profile student.user.id %}" class="person">
						    {{student.user.get_full_name}}</a></td>
						<td>{{student.matricula}}</td>
						<td>
							{{student.program}}
							{% if student.is_zamawiany %}
								(zamawiane)
							{% endif %}
						</td>
						<td>{{student.semestr}}</td>
					</tr>
			
				{% empty %}
					Brak zapisanych osób.
				{% endfor %}
			</tbody>
		</table><br />
        <a href="mailto:{% for student in students_in_group %},{{ student.user.email }}{% endfor %}">[Wyślij wiadomość do grupy]</a>
		<br/>
		{%if students_in_queue %}
			<h3>Lista osób oczekujących na zapis:</h3>
			<p> Liczba osób oczekujących na zapis: {{students_in_queue|length}} </p>
			<br/>
			<table>
				<tbody>
					{% for student in students_in_queue %}
						<tr>
							<td><a href="{% url student-profile student.user.id %}"{% if student.pk == user.student.pk %} class="bold"{% endif %}>
							    {{student.user.get_full_name}}</a></td>
							<td {% if student.pk == user.student.pk %} class="bold"{% endif %}>{{student.matricula}}</td>
							<td>
								{{student.program}}
								{% if student.is_zamawiany %}
									(zamawiane)
								{% endif %}
							</td>
						</tr>
					{% endfor %}
				</tbody>
			</table>
		{% endif %}
	</div>
{% endblock %}
