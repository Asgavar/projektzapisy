{% extends "enrollment/base.html" %}
{% load fereol_common %}
{% load compressed %}
{% load cache %}
{% load multifor %}
{% block main-subtitle %}Plan zajęć{% endblock %}

{% block styles %}
    {% compressed_css 'schedule' %}
{% endblock %}
{% block js %}
    {% compressed_js 'schedule' %}
{% endblock %}

{% block enrollment_menu_schedule %} class="active"{% endblock %}

{% block bread %}
	<a href="{% url main-page %}">Strona główna</a> &raquo;
	<a href="{% url enrollment-main %}">Zapisy</a> &raquo;
	Plan zajęć
{% endblock %}

{% block center %}
    <div  style="float:right;margin-bottom: 20px;"><a href="{% url ical %}">Eksportuj do ical</a>
    </div>
	<div id="enr-schedule-scheduleContainer">
	</div>
    {% cache 500 own-schedyle request.user %}
	{% if user.student %}
        <h3>Zajęcia, na które jesteś zapisany</h3>
	{% else %}
        <h3>Zajęcia, które prowadzisz</h3>
	{% endif %}
	<table id="enr-schedule-listByCourse" class="zebra-striped">
		<thead>
			<tr>
				<th>Przedmiot</th>
				{% if user.student %}
                    <th class="ects">ECTS</th>
                {% else %}
                    <th class="ects">Godziny</th>
                {% endif %}
			</tr>
		</thead>
		<tfoot>
			<tr>
			{% if user.student %}
				<td>Suma punktów ECTS:</td>
				<td class="ects">{{ sum_points }}</td>
            {% else %}
                <td>Liczba godzin:</td>
                <td class="ects">{{ hours_sum }}</td>    
            {% endif %}
			</tr>
		</tfoot>
		<tbody>
            {% regroup schedule by group.course as courses %}
            {% for course in courses; point in points %}
            <tr class="courseHeader">
                <td class="name">
                    <a href="{% url course-page course.grouper.slug %}">
                        {{ course.grouper.name }}
                    </a>
                </td>
                <td rowspan="2" class="ects">
                    {{ point.value }}
                </td>
            </tr>
            <tr class="courseDetails">
                <td>
                    <input type="hidden" name="id" value="{{ course.grouper.id }}" />
                    <input type="hidden" name="name" value="{{ course.grouper.name }}" />
                    <input type="hidden" name="type" value="{{ course.grouper.type }}" />
                    <input type="hidden" name="short" value="{{ course.grouper.short }}" />
                    <input type="hidden" name="url" value="{% url course-page course.grouper.slug %}" />
                    <ul>
                        {% for item in course.list %}
                        {% with item.group as group %}
                        <li>
                            <span class="type">{{ group.get_type_display }}:</span>
                            {% for term in group.term.all %}
                            <span class="term">
                                {{ term.get_dayOfWeek_display }}
                                {{ term.start_time|time:'G:i' }}-{{ term.end_time|time:'G:i' }}
                            </span>
                            <span class="classroom">sala:
                                  {% for classroom in term.classrooms.all %}
                                    {{ classroom.number }}
                                  {% endfor %}
                            </span>
                            {% endfor %}
                            <input type="hidden" name="term" value="{{ term.json }}" />
                        </li>
                        {% endwith %}
                        {% endfor %}
                    </ul>
                </td>
            </tr>
            {% endfor %}
		</tbody>
	</table>
    {% endcache %}
{% endblock %}
