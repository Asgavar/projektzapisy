{% extends "offer/base.html" %}

{% load preferences_extras %}
{% load compressed %}
{% load i18n %}

{% block main-subtitle %}Preferencje{% endblock %}

{% block enrollment_preferences %} class="active"{% endblock %}

{% block bread %}
	<a href="/">Strona główna</a> &raquo;
	<a href="{% url offer-main %}">Oferta</a> &raquo;
	Preferencje
{% endblock %}

{% block js %}
    {% compressed_js 'preferences' %}
    <script>
    $(document).ready(function(){
        var showhidden = false;
        function getRow(elem) {
            return row = $(elem).closest("tr");
        };
        function getPrefId(row) {
            return id = $(row).children('.pref-id').eq(0).val();
        };
        function processFormChange(elem) {
            var row = getRow(elem);
            $(row).css('background', 'red')
            var data = {
                prefid: getPrefId(row),
                csrfmiddletoken: '{{ csrf_token }}',
            };
            var changedselname = $(elem).attr('name').split('-')[2];
            data[changedselname] = $(elem).val();
            $.post('{% url preference-save %}', data, 
                function(newRow){
                    row.replaceWith(newRow);
                }
            );
            $('.hiddenrow').toggle(showhidden);
        };
        $("tr input").change(function(){
            processFormChange(this);
        })
        $("tr select").change(function(){
            processFormChange(this);
        })

    });
    </script>
    <style>.hidden { display: none;}</style>
{% endblock %}

{% block scripts %}
{% endblock %}


{% block top-bar %}
{% endblock %}

{% block content-width %}16{% endblock %}
{% block content %}
    <button type="submit" class="btn info showall">Pokaż ukryte</button>&nbsp;
    <button style="display: none;" type="submit" class="btn info hidehidden">Ukryj ukryte</button>&nbsp;
    <table class="zebra-striped">
        <thead>
            <tr>
                <th>{% trans "Przedmiot" %}</th>
                <th>{% trans "Wykład" %}/{% trans "Seminarium" %}</th>
                <th>{% trans "Ćwiczenia" %}</th>
                <th>{% trans "Pracownia" %}/{% trans "Ćwiczenio-Pracownia" %}</th>
                <th>{% trans "Repetytorium" %}</th>
                <th>{% trans "Ukryte" %}
            </tr>
        </thead>
        {% for form in formset %}
        <tr{% if form.instance.hidden %} class="hiddenrow"{% endif %}>
            <input type="hidden" class="pref-id" name="pref-id" value="{{ form.instance.id }}">
            <td><a href="{% url offer-page form.instance.proposal.slug %}">{{ form.instance.proposal }}</a></td>
            <td>{% if form.instance.proposal.have_lecture %}{{ form.lecture }}{% elif form.instance.proposal.have_seminar %}{{ form.seminar }}{% endif %}</td>
            <td>{% if form.instance.proposal.have_tutorial %}{{ form.tutorial }}{% endif %}</td>
            <td>{% if form.instance.proposal.have_lab %}{{ form.lab }}{% elif form.instance.proposal.have_tutorial_lab %}{{ form.tutorial_lab }}{% endif %}</td>
            <td>{% if form.instance.proposal.have_review_lecture %}{{ form.review_lecture }}{% endif %}</td>
            <td>{{ form.hidden }}</td>
        </tr>
        {% endfor %}
        
    </table>
    <button type="submit" class="btn info showall">Pokaż ukryte</button>&nbsp;
    <button style="display: none;" type="submit" class="btn info hidehidden">Ukryj ukryte</button>&nbsp;
{% endblock %}

{% block sidebar-width %}0{% endblock %}
{% block sidebar %}
{% endblock %}
