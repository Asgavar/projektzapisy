{% extends "schedule/base.html" %}

{% block schedule_reservation %} class="active"{% endblock %}

{% block bread %}
    <a href="/">Strona główna</a> &raquo;
    <a href="{% url events:classrooms %}">Sale</a> &raquo;
{% endblock %}

{% block styles %}
    {{ block.super }}

    <link href="/site_media/css/jquery-ui-1.8.14.custom.css" rel="stylesheet" type="text/css"
          media="screen,projection"/>
    <link href="/site_media/js/timepicker/jquery.ui.timepicker.css" rel="stylesheet" type="text/css"
          media="screen,projection"/>
{% endblock %}

{% block js %}{{ block.super }}
    <style>
        .hidden {
            display: none !important;
        }

        .termtbl1 {
            width: 180px;
        }

        .termtbl4 {
            width: 300px;
        }

        .termtbl2 {
            width: 90px;
        }

        .termtbl3 {
            width: 261px;
        }

        #termstable td:nth-child(3), table td:nth-child(4), table th:nth-child(3), table th:nth-child(4) {
            text-align: left;
        }

        .removed {
            color: #d3d3d3;
        }

        .errorlist {
            list-style: none;
        }

        .errorlist > li {
            color: red;
        }

        *:invalid: {
            border: 2px solid red;
        }


    </style>
    <script type="text/javascript" src="/site_media/js/timepicker/jquery.ui.timepicker.js"></script>
    <script type="text/javascript" src="/site_media/js/timepicker/i18n/jquery.ui.timepicker-pl.js"></script>
    <script type="text/javascript" src="/site_media/js/jquery/jquery.smooth-scroll.js"></script>
    <script type="text/javascript">


    /* Loader Class
     *
     *
     *
     */

    var CleanTermForm = function () {
        $('#term').attr('value', '');
        $('#begin').attr('value', '');
        $('#end').attr('value', '');
        $('#hiddenroom').attr('value', '');
        $('#location').attr('value', '');
        $('input[name="selectplace"]').each(function () {
            $(this).attr('checked', false);
        });
        $('#inputplace').attr('value', '');
        $('#inputplacediv').hide();
        $('#selectroom').hide();
        $('#canvasplacediv').hide();
        $('#addterm').text('Dodaj termin');
        $('#location').parent().css('border-bottom', '1px solid #DDD');
    }


    function relMouseCoords(evt) {
        var rect = this.getBoundingClientRect();
        return {
            x:evt.clientX - rect.left,
            y:evt.clientY - rect.top
        };
    }
    HTMLCanvasElement.prototype.relMouseCoords = relMouseCoords;

    var chosenbutton = new Image();
    chosenbutton.src = '/site_media/images/choose.png';

    var Loader = function (container) {
        {#        this.container = container;#}
        {#        this.spinner = new Object();#}
        {#        this.spinner = new Spinner();#}
    };

    Loader.prototype.start = function () {

        {#        var that = this,#}
        {#                opacity = 1.0,#}
        {#                animate = function () {#}
        {#                    that.container.style.opacity = opacity;#}
        {#                    opacity -= 0.1;#}
        {#                    if (opacity > 0.2) {#}
        {#                        setTimeout(animate, 100);#}
        {#                    }#}
        {#                }#}
        {#                ;#}
        {##}
        {#        setTimeout(animate, 100);#}
        {#        this.spinner.spin(this.container);#}
    };

    Loader.prototype.stop = function () {
        {#        this.spinner.stop();#}
        {#        this.container.style.opacity = 1.0;#}
    };

    var AjaxWrapper = function () {
        this.makeURL = function (date) {
            var s = date.split('-');
            return '/classrooms/terms/' + s[0] + '/' + s[1] + '/' + s[2] + '/';
        };
        this.cache = {};
    };

    AjaxWrapper.prototype.getJson = function (date, callback) {

        if (this.cache.hasOwnProperty(date)) {
            callback.call(this.cache[date], this.cache[date]);
            return;
        }

        var url = this.makeURL(date),
                that = this;
        var r = new XMLHttpRequest();

        r.open("GET", url, true);
        r.onreadystatechange = function () {
            if (r.readyState != 4 || r.status != 200) return; //error
            that.cache[date] = JSON.parse(r.responseText);
            callback.call(that.cache[date], that.cache[date]);

        };
        r.send('');
    };

    function check(input) {
        if (input.value != document.getElementById('email_addr').value) {
            input.setCustomValidity('The two email addresses must match.');
        } else {
            // input is valid -- reset the error message
            input.setCustomValidity('');
        }
    }

    {#    function check(input) {#}
    {#      if (input.value != document.getElementById('email_addr').value) {#}
    {#        input;#}
    {#      } else {#}
    {#        // input is valid -- reset the error message#}
    {#        input.#}
    {#      }#}
    {#    }#}


    var ReservationView = function () {
        $('#end').change(function () {
            var start = $('#begin').val() + ':00',
                    end = $(this).val() + ':00';
            if (end < start) {
                this.setCustomValidity('Koniec musi następować po początku');
            } else {
                this.setCustomValidity('');
            }
        })

        var container = document.getElementById('addTermForm');
        var canvas = document.getElementById('can');

        var load = new Loader(container);
        var Ajax = new AjaxWrapper();
        var rooms = new ClassroomsList();


        $('.timepicker').timepicker({hours:{
            starts:8, // First displayed hour
            ends:21                  // Last displayed hour
        }});


        var changeType = function () {
            var type = document.getElementById('id_type'),
                    subject = document.getElementById('form_course'),
                    visible = document.getElementById('form_visible'),
                    title = document.getElementById('form_title'),
                    message = document.getElementById('sendmessage_visible'),
                    onchange = function () {
                        switch (type.value) {
                            case '0':
                            case '1':
                                $(subject).show();
                                $(title).hide();
                                $(visible).hide();
                                $('#id_course').attr('required', true);
                                $('#id_title').attr('required', false);
                                break;

                            case '2':
                                $(subject).hide();
                                $(title).show();
                                $(visible).show();
                                $('#id_course').attr('required', false);
                                $('#id_title').attr('required', true);
                                break;
                        }
                    }
                    ;
            if (type) {
                type.addEventListener('change', onchange, true);
                onchange();
            }
        };

        var addterm = function () {
            var addbutton = document.getElementById('addterm'),
                    form = document.getElementById('addTermForm'),
                    term = document.getElementById('term'),
                    from = document.getElementById('begin'),
                    to = document.getElementById('end'),

                    onchangeTerm = function (event) {
                        event.preventDefault();


                    },
                    onchangeHour = function (event) {
                        event.preventDefault();
                    },
                    onclickCanvas = function (event) {
                        rooms.click(event, function (item) {
                            $('#hiddenroom').val(item.id);
                            $('#location').val('Sala ' + item.title);
                            $.smoothScroll({
                                scrollElement:null,
                                scrollTarget:'#location'
                            });
                        })
                    };


            canvas.addEventListener('click', onclickCanvas, true);
            from.addEventListener('change', onchangeHour, true);
            to.addEventListener('change', onchangeHour, true);


        };


        $('#addoutsidelocation').click(function (event) {
            $('#hiddenroom').val("");
            $('#location').val($('#inputplace').val());
            $.smoothScroll({
                scrollElement:null,
                scrollTarget:'#location'
            });
            event.preventDefault();
        });

        $('#term').change(function (event) {
            if ($(this).val() === '') {
                $('#location').attr('disabled', true);
                $('#location').parent().css('border-bottom', '1px solid #DDD');
                $('#selectroom').hide();

            } else {
                $('#location').attr('disabled', false);
                loadTerms($('#term').val());
            }
        });

        $('#location').click(function (event) {
            event.preventDefault();
            $('#selectroom').show();
            $(this).parent().css('border-bottom', '0');
        });

        $('#addtermform').submit(function (event) {

            if ($('#hiddenid').val()) {

                var counter = parseInt($('#hiddenid').val());
            } else {
                var counter = parseInt($('input[name="term_set-TOTAL_FORMS"]').val());
            }


            var td;
            var html = $('<tr></tr>');

            event.preventDefault();
            td = $('<td></td>').append('<strong>' + $('#term').val() + '</strong>')
                    .append($('<input type="hidden" name="term_set-' + counter + '-day"  value="' + $('#term').val() + '">'))

            $(html).append(td);

            td = $('<td></td>').append('<span>' + $('#begin').val() + '</span>').append($('<input type="hidden" name="term_set-' + counter + '-start"  value="' + $('#begin').val() + '">'));


            $(html).append(td);

            td = $('<td></td>').append('<span>' + $('#end').val() + '</span>').append($('<input type="hidden" name="term_set-' + counter + '-end"  value="' + $('#end').val() + '">'));


            $(html).append(td);

            td = $('<td></td>')
                    .append($('<span>' + $("#location").val() + '</span>'))
                    .append($('<input type="hidden" name="term_set-' + counter + '-place" maxlength="255" value="' + $("#location").val() + '">'))
                    .append($('<input type="hidden" name="term_set-' + counter + '-room" value="' + $("#hiddenroom").val() + '">'));

            if ($('#hiddenid').val() && $('#termstable tbody tr').eq(counter).find('input[name$="-id"]').length > 0) {
                td.append(
                        jQuery("<p>").append($('#termstable tbody tr').eq(counter).find('input[name$="-id"]').clone()).html());
            }

            $(html).append(td);
            $(html).append($('<td><div class="hidden"><input type="checkbox" name="term_set-' + counter + '-DELETE" id="id_term_set-' + counter + '-DELETE"></div><button style="display:none" class="btn success unremoveterm" formnovalidate>Cofnij usunięcie</button><button class="btn danger removeterm" formnovalidate>Usuń</button></td>'));
            $(html).append($('<td><button class="btn editterm">Edytuj</button></td>'));

            if ($('#hiddenid').val()) {
                $('#termstable tbody tr').eq(counter).after(html);
                $('#termstable tbody tr').eq(counter).remove();
            } else {
                $('input[name="term_set-TOTAL_FORMS"]').val(parseInt(counter) + 1);
                $('#termstable tbody').append(html);
            }
            $('#location').attr('disabled', true);
            CleanTermForm();


        });

        $('.removeterm').live('click', function (event) {
            event.preventDefault();
            var parent = $(this).parent();
            parent.find('.hidden').find('input').attr('checked', true);
            parent.find('.unremoveterm').show();
            parent.parent().find('.editterm').hide();
            parent.parent().addClass('removed');
            $(this).hide();

        })

        $('.unremoveterm').live('click', function (event) {
            event.preventDefault();
            var parent = $(this).parent();
            parent.find('.hidden').find('input').attr('checked', false);
            parent.find('.removeterm').show();
            parent.parent().find('.editterm').show();
            parent.parent().removeClass('removed');
            $(this).hide();

        });


        var loadTerms = function (value) {
            Ajax.getJson(value, function (data) {
                rooms.load(data);
                rooms.setLines($('#begin').val(), $('#end').val());
                rooms.draw();
            });
        };

        $('input[name="selectplace"]').change(function () {
            switch ($(this).val()) {
                case 'inside':
                    $('#rooms_filter').show();
                    $('#inputplacediv').hide();
                    $('#canvasplacediv').show();
                    loadTerms($('#term').val());
                    break;

                case 'outside':
                    $('#rooms_filter').hide();
                    $('#canvasplacediv').hide();
                    $('#inputplacediv').show();
                    break;
            }
        });

        $('.timepicker').change(function () {
            rooms.setLines($('#begin').val(), $('#end').val());
            rooms.draw();
        });


        $('#filteroccupated').change(function () {
            rooms.draw();

        });

        $('#save_event').click(function (event) {

            if ($('#termstable tbody').find('tr:not(.removed)').length == 0) {
                this.setCustomValidity('Musisz podać przynajmniej jeden termin');
            } else {
                this.setCustomValidity('');
                $('#testmainform').click();
            }
        });

        $('#testroomlistform').submit(function (e) {
            e.preventDefault();
        })

        $('.editterm').live('click', function (event) {
            var parent = $(this).parent().parent();
            var room = parent.find('input[name$="-room"]').val();
            var number = parent.parent().children().index(parent);
            var test = ("" === room);
            event.preventDefault();
            parent.addClass('edited');
            $('#addterm').text('Zmień termin');
            $('#term').val(parent.find('input[name$="-day"]').val());
            $('#begin').val(parent.find('input[name$="-start"]').val());
            $('#end').val(parent.find('input[name$="-end"]').val());
            $('#location').val(parent.find('input[name$="-place"]').val());

            $('#hiddenroom').val(room);
            $('#hiddenid').val(number);

            $('#location').attr('disabled', false);


            $('input[name="selectplace"]').each(function () {
                if ($(this).val() == 'outside') {
                    $(this).attr('checked', test);
                } else {
                    $(this).attr('checked', !test);

                }
            });

            $('#location').click();
            if (test) {
                $('#inputplace').val($('#location').val());
            }

            $('input[name="selectplace"]:checked').each(function () {
                switch ($(this).val()) {
                    case 'inside':
                        $('#rooms_filter').show();
                        $('#inputplacediv').hide();
                        $('#canvasplacediv').show();
                        loadTerms($('#term').val());
                        break;

                    case 'outside':
                        $('#rooms_filter').hide();
                        $('#canvasplacediv').hide();
                        $('#inputplacediv').show();
                        break;
                }
            });


        });

        $('.readonly').keydown(function (event) {
            event.preventDefault();
        })

        changeType();
        addterm();


    };


    var Classroom = function (ctx, item) {
                var config = {
                            width:400,
                            height:30,
                            corner:10,
                            boxheight:65,
                            x1:120,
                            y1:30,
                            y1a:30,
                            calculate:function () {
                                /*
                                 a******b
                                 e        g
                                 *        *
                                 f        h
                                 c******d

                                 for example b-g is rounded corner
                                 a - (x1, y1)
                                 b - (x2, y1)
                                 c - (x2, y2)
                                 d - (x2, y2)
                                 e - (x1corner, y1corner)
                                 f - (x1corner, y2corner)
                                 g - (x2corner, y1corner)
                                 h - (x2corner, y2corner)

                                 */
                                this.x2 = this.x1 + this.width;
                                this.y2 = this.y1 + this.height;
                                this.x1corner = this.x1 - this.corner;
                                this.x2corner = this.x2 + this.corner;
                                this.y1corner = this.y1 + this.corner;
                                this.y2corner = this.y2 - this.corner;
                                this.strokeStyle = ctx.strokeStyle;
                                this.evenHours = ['08:00', '10:00', '12:00', '14:00', '16:00', '18:00', '20:00', '22:00'];
                                that = this;

                                var getPixel = function (hour) {
                                    /*
                                     Find pixel location for time (clock).
                                     Eg. 8:00 - it's begining of axe, 22:00 - end,
                                     15:00 - it's center.
                                     */
                                    var cellSize = that.width / (that.evenHours.length - 1);
                                    var time = hour.split(":"),
                                            hours = (parseInt(time[0]) - 8) * cellSize / 2,
                                            minutes = Math.floor(( parseInt(time[1]) / 60 ) * cellSize) / 2;
                                    return hours + minutes;
                                };
                                this.terms = [];
                                for (var key in item.terms) {
                                    if (item.terms.hasOwnProperty(key)) {
                                        var event = item.terms[key];


                                        begin = getPixel(event.begin) + this.x1;
                                        end = getPixel(event.end) + this.x1;
                                        this.terms.push({'begin':begin, 'end':end});
                                    }
                                }

                                return this;
                            },
                            init:function () {
                                this.calculate();
                                delete this.init;
                                return this;
                            }
                        }.init(),

                        cellSize = config.width / (config.evenHours.length - 1),

                        drawButton = function () {

                            if (is_free()) {
                                ctx.drawImage(chosenbutton, config.x1 - 100, config.y1 + 1);
                            }
                        },

                        drawTitle = function () {
                            ctx.beginPath();
                            var save = ctx.font;
                            ctx.strokeStyle = config.strokeStyle;
                            ctx.font = '20px Calibri';
                            ctx.fillText(item.title, config.x2corner + 10, config.y1 + 3 * config.height / 4);
                            ctx.stroke();
                            ctx.font = save;

                        },

                        drawBorder = function () {
                            /*
                             Draw borders
                             */
                            var c = config,
                                    save = ctx.strokeStyle;
                            ctx.beginPath();
                            ctx.moveTo(c.x1, c.y1);
                            ctx.lineTo(c.x2, c.y1);
                            ctx.quadraticCurveTo(c.x2corner, c.y1, c.x2corner, c.y1corner);
                            ctx.lineTo(c.x2corner, c.y2corner);
                            ctx.quadraticCurveTo(c.x2corner, c.y2, c.x2, c.y2);
                            ctx.lineTo(c.x1, c.y2);
                            ctx.quadraticCurveTo(c.x1corner, c.y2, c.x1corner, c.y2corner);
                            ctx.lineTo(c.x1corner, c.y1corner);
                            ctx.quadraticCurveTo(c.x1corner, c.y1, c.x1, c.y1);
                            ctx.stroke();

                            ctx.strokeStyle = save;
                        },

                        drawHours = function () {
                            var saveStroke = ctx.strokeStyle,
                                    saveAlign = ctx.textAlign,
                                    saveFont = ctx.font;
                            ctx.beginPath();
                            ctx.strokeStyle = "#787878";
                            ctx.textAlign = "left";
                            ctx.font = '12px Calibri';

                            for (var i = 0; i < config.evenHours.length; ++i) {
                                var x = config.x1 + i * cellSize;
                                ctx.moveTo(x, config.y1);
                                ctx.lineTo(x, config.y2);
                                ctx.fillText(config.evenHours[i], x - 14, config.y2 + 12);

                            }
                            ctx.stroke();
                            ctx.strokeStyle = saveStroke;
                            ctx.textAlign = saveAlign;
                            ctx.font = saveFont;
                        },


                        drawEvents = function () {
                            var saveStyle = ctx.fillStyle;
                            for (var key in config.terms) {
                                if (config.terms.hasOwnProperty(key)) {
                                    var event = config.terms[key];
                                    ctx.beginPath();
                                    ctx.fillStyle = "#b0c2f7";
                                    ctx.globalAlpha = 0.5; // Half opacity
                                    ctx.fillRect(event.begin, config.y1, event.end - event.begin, config.height);
                                    ctx.stroke();
                                    ctx.globalAlpha = 1;
                                }
                            }
                            ctx.fillStyle = saveStyle;
                        },

                        draw = function (index) {

                            config.y1 = config.y1a + index * config.boxheight;
                            config.calculate();
                            drawButton();
                            drawTitle();
                            drawBorder();
                            drawHours();
                            drawEvents();
                        },

                        getPixel = function (hour) {
                            /*
                             Find pixel location for time (clock).
                             Eg. 8:00 - it's begining of axe, 22:00 - end,
                             15:00 - it's center.
                             */

                            var time = hour.split(":"),
                                    hours = (parseInt(time[0]) - 8) * cellSize / 2,
                                    minutes = Math.floor(( parseInt(time[1]) / 60 ) * cellSize) / 2;
                            return hours + minutes;
                        },

                        click = function (event, cordinates, callback) {
                            if (!is_free()) return;
                            if ((cordinates.x >= config.x1 - 100) && (cordinates.x < config.x1 - 20)
                                    && (cordinates.y >= config.y1 + 1) && ( cordinates.y < config.y1 + 32)) {
                                callback.call(item, item);
                            }
                        },
                        lpixel, rpixel,
                        setLimit = function (left, right) {
                            lpixel = left;
                            rpixel = right;
                        },

                        is_free = function () {
                            if (!rpixel || !lpixel) {
                                return false;
                            }
                            for (var key in config.terms) {
                                if (config.terms.hasOwnProperty(key)) {
                                    var pitem = config.terms[key];
                                    if ((lpixel - pitem.end <= 1 && rpixel - pitem.begin >= -1) ||
                                            (pitem.begin - rpixel <= 1 && pitem.end - lpixel >= -1)) {
                                        return false;
                                    }
                                }
                            }
                            return true;
                        }
                        ;

                return {
                    draw:draw,
                    getPixel:function (item) {
                        return getPixel(item) + config.x1;
                    },
                    shouldBeShow:function (l, r) {
                        setLimit(getPixel(l) + config.x1, getPixel(r) + config.x1);
                        return is_free();
                    },
                    setLimit:setLimit,
                    click:click
                }
            },
            ClassroomsList = function () {

                var that = this,
                        init = function () {
                            that.canvas = document.getElementById("can");
                            that.ctx = document.getElementById("can").getContext("2d");
                        },

                        click = function (event, callback) {
                            var cords = that.canvas.relMouseCoords(event);
                            var nr = Math.floor(cords.y / 65);
                            classrooms[ toDraw[nr] ].click(event, cords, callback);
                        },

                        classrooms = [],
                        clearClassrooms = function () {
                            classrooms = [];
                        },
                        createClassroom = function (data) {
                            for (var classroom in data) {

                                if (data.hasOwnProperty(classroom)) {
                                    classrooms.push(new Classroom(that.ctx, data[classroom]));
                                }
                            }
                        },

                        lineFrom, lineTo,
                        setLines = function (from, to) {
                            lineFrom = from;
                            lineTo = to;
                        },

                        redraw = function () {

                        },
                        toDraw,
                        draw = function () {
                            var index = 0
                                    ;

                            toDraw = [];

                            for (var classroom in classrooms) {
                                if (classrooms.hasOwnProperty(classroom) && (shouldBeShow(classrooms[classroom]) || $('#filteroccupated').attr('checked') )) {
                                    toDraw[index] = classroom;
                                    index++;
                                }
                                that.canvas.height = 65 * (index + 1);
                            }
                            index = 0;
                            var lPixel, rPixel;
                            for (var c in toDraw) {
                                if (toDraw.hasOwnProperty(c)) {
                                    if (index === 0) {
                                        if (lineFrom) {
                                            lPixel = classrooms[toDraw[c]].getPixel(lineFrom);

                                        }
                                        if (lineTo) {
                                            rPixel = classrooms[toDraw[c]].getPixel(lineTo);
                                        }
                                    }
                                    classrooms[toDraw[c]].setLimit(lPixel, rPixel);
                                    classrooms[toDraw[c]].draw(index++);
                                }
                            }

                            if (lPixel) {
                                that.ctx.strokeStyle = "red";
                                that.ctx.beginPath();
                                that.ctx.moveTo(lPixel, 0);
                                that.ctx.lineTo(lPixel, that.canvas.height);
                                that.ctx.stroke();
                            }

                            if (rPixel) {
                                that.ctx.strokeStyle = "red";
                                that.ctx.beginPath();
                                that.ctx.moveTo(rPixel, 0);
                                that.ctx.lineTo(rPixel, that.canvas.height);
                                that.ctx.stroke();
                            }
                        },

                        shouldBeShow = function (classroom) {
                            var r = classroom.shouldBeShow(lineFrom, lineTo);
                            return r;
                        },
                        load = function (data) {
                            clearClassrooms();
                            createClassroom(data);
                        }
                        ;

                init();

                return {
                    'draw':draw,
                    'load':load,
                    'setLines':setLines,
                    'redraw':redraw,
                    'click':click
                };

            },


            cleanAddTermForm = function () {
            },


            init = function () {
                addterm();
            };

    window.onload = ReservationView;
    </script>
{% endblock %}

{% block content-width %}16{% endblock %}

{% block content %}
    <div class="row">
        <div class="span16">
            <h2>Nowa rezerwacja</h2>
        </div>
    </div>

    <form method="POST" id="mainform">
        {% csrf_token %}
        {% for hidden in form.hidden_fields %}
            {{ hidden }}
        {% endfor %}
        {{ form.non_field_errors }}
        <fieldset>

            {% if user.employee %}

                <div class="clearfix row">
                    <div class="span10">
                            <label for="id_type">Rodzaj</label>
                            <div class="input clearfix">
                                {{ form.type }}

                            </div>
                            </div>

                    <div class="span6" style="font-size:12px">
                        <span><strong>Egzaminy</strong> i <strong>kolokwia</strong>
                                                        - prowadzący moze zarezerwować salę, rezerwacja nie wymaga potwierdzenia</span>
                        <br/>
                        <br/>
                        <span><strong>Wydarzenia</strong> - każdy zalogowany może zgłosić chęć rezerwacji; rezerwacja zostaje potwierdzona lub odrzucona przez administratora sal.</span>
                    </div>
                          </div>

                <div id="form_course" class="row clearfix" style='display:none;'>
                    <div class="span10">
                    <label for="id_course">Przedmiot</label>
                    <div class="input">
                        {{ form.course }}
                    </div>
                  </div>
                  </div>



            {% endif %}

            <div id="form_title" class="row clearfix" style="display: none;">
                <div class="span10">
                <label for="id_title">Tytuł</label>
                        <div class="input">
                            {{ form.title }}
                        </div>
                      </div>
                <div class="span6">

                    <span style="font-size:12px">Tytuł pod jakim widoczne będzie wydarzenie</span>
                </div>
                      </div>


            <div id="form_visible" class="row clearfix">
                <label id="optionsCheckboxes">Opcje</label>
                <div class="input">
                    <ul class="inputs-list">
                        <li>
                            <label>
                              {{ form.visible }}
                                <span>Wydarzenie widoczne dla wszystkich użytkowników systemu</span>
                            </label>
                        </li>

                  </ul>
                          <span style="font-size:12px;">
                            <strong>Uwagi:</strong> Wydarzenia niepubliczne widoczne są jedynie dla autorów i osób z uprawnieniami moderatora.
                          </span>
                        </div>
          </div>

            <div class="clearfix row">
                <div class="span10">
                        <label for="id_description">Opis</label>

                        <div class="input">
                            <div style="margin-right:10px">{{ form.description }}</div>
                            {{ form.description.errors }}&nbsp;
                        </div>
                      </div>
                <div class="span6">
                    <span style="font-size:12px">
                        Opis wydarzenia widoczny jest dla wszystkich, jeśli wydarzenie jest publiczne; widoczny tylko dla rezerwującego i administratora sal, gdy wydarzenie jest prywatne.
                    </span>
                </div>
            </div>

        </fieldset>

        <h3>Terminy</h3>

        {% if formset.errors %}
            <ul>
                {% for error in formset.errors %}
                    <li class="error">{{ error }}</li>
                {% endfor %}
            </ul>
        {% endif %}
        {{ formset.management_form }}
        <table id="termstable" class="span16">
            <thead>
            <tr>
                <th class="termtbl1">Dzień</th>
                <th class="termtbl2">Od</th>
                <th class="termtbl2">Do</th>
                <th class="termtbl4">Lokalizacja</th>
                <th class="termtbl3" colspan="2">Akcje</th>
            </tr>
            </thead>
            <tbody>
            {% for form in formset %}
                <tr>
                    <td class="termtbl1"><strong>{{ form.instance.day|date:"Y-m-d" }}</strong>{{ form.day }}</td>
                    <td class="termtbl2"><span>{{ form.instance.print_start }}</span>{{ form.start }}</td>
                    <td class="termtbl2"><span>{{ form.instance.print_end }}</span>{{ form.end }}{{ form.id }}</td>
                    <td class="termtbl4"><span>{% if form.instance.room %}Sala
                        {{ form.instance.room.number }}{% else %}
                        {{ form.instance.place }}{% endif %}{{ form.room }}{{ form.place }}</span></td>
                    <td>
                        <div class="hidden">{{ form.DELETE }}</div>
                        <button style="display:none" class="btn success unremoveterm" formnovalidate>Cofnij
                            usunięcie
                        </button>
                        <button class="btn danger removeterm" formnovalidate>Usuń</button>
                    </td>
                    <td>
                        <button class="btn editterm" formnovalidate>Edytuj</button>
                    </td>
                </tr>
            {% endfor %}

            </tbody>
        </table>
        <input type="submit" style="display:none" name="sendthisform" value="test" id="testmainform">
    </form>
    <form id="addtermform" class="span16">
        <table>
            <tbody>
            <tr>
                <td class="termtbl1">
                    <input id="term" type="date" class="term small" placeholder="{% now "Y-m-d" %}"
                           min="{% now "Y-m-d" %}" required>
                </td>
                <td class="termtbl2">
                    <input id="begin" type="time" class="begin mini timepicker readonly" placeholder="np. 8:00" required
                           pattern="^([0-1]?[0-9]|2[0-4]):([0-5][0-9])(:[0-5][0-9])?$">

                </td>
                <td class="termtbl2">
                    <input id="end" type="time" class="end mini timepicker readonly" placeholder="np. 10:00" required
                           pattern="^([0-1]?[0-9]|2[0-4]):([0-5][0-9])(:[0-5][0-9])?$">
                </td>
                <td class="termtbl1">
                    <input type="hidden" id="hiddenroom" value="">
                    <input type="hidden" id="hiddenid" value="">
                    <input type="hidden" id="hiddeneventid" value="">
                    <input class="xlarge readonly" id="location" autocomplete="off" name="location"
                           placeholder="Miejsce" disabled="true"
                           type="text" required>
                </td>
                <td colspan="2" class="termtbl3">
                    <button id="addterm" class="btn success">Dodaj termin</button>
                </td>
            </tr>
            </tbody>
        </table>
    </form>

    <form>
        <div id="selectroom" class="row" style="display:none;">
            <div class="span8">
                <div class="input">
                    <ul class="inputs-list">
                        <li>
                            <label>
                                <input type="radio" name="selectplace" value="outside">
                                <span>Miejsce zewnętrzne</span>
                            </label>
                        </li>
                        <li>
                            <label>
                                <input type="radio" name="selectplace" value="inside">
                                <span>Sala Instytutu</span>
                            </label>
                        </li>

                    </ul>
                </div>
            </div>
            <fieldset id="rooms_filter" class="span7" style="display: none;">
                <legend>Filtruj sale</legend>
                <div class="input">
                    <ul class="inputs-list">
                        <li>
                            <label>
                                <input id="filteroccupated" type="checkbox" name="selectsssplace" value="outside"
                                       checked>
                                <span>Pokaż zajęte</span>
                            </label>
                        </li>
                        {#                                    <li>#}
                        {#                                        <label>#}
                        {#                                            <input type="checkbox" name="selesssctplace" value="inside">#}
                        {#                                            <span>Minimalna liczba miejsc</span>#}
                        {#                                        </label>#}
                        {#                                    </li>#}

                    </ul>
                </div>
            </fieldset>
        </div>


        <div id="inputplacediv" class="row" style="display: none;">
            <div class="row">
                <div class="span1">
                    <label for="inputplace">Miejsce</label>
                </div>
                <div class="span11">
                    <div class="input">
                        <div class="inline-inputs">
                            <input type="text" id="inputplace" class="span6"
                                   placeholder="np. Instytu Matematyczny, Sala HS">
                            <button class="btn success" id="addoutsidelocation">Dodaj</button>
                        </div>
                    </div>
                </div>
                <div class="span4 help-block">Musisz samemu zatroszczyć się o rezerwację!</div>
            </div>
        </div>
        <div id="canvasplacediv" class="row" style="display: none;">
            <canvas id="can" width="700">
                Niestety Twoja przeglądarka nie wspiera HTML5.
            </canvas>
        </div>
    </form>
    <div class="row">
        <form id="testroomlistform">
            <div class="span16 right" style="text-align:right">
                <input type="submit" id="save_event" class="btn" name="zapisz" value="Zapisz">
            </div>
        </form>
    </div>


{% endblock %}